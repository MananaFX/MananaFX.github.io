import{_ as A,d as V,u as C,k,r as E,M as X,a4 as v,x as d,w as s,s as B,m as _,o as m,p as f,q as p,h as u,j as g,f as L,y as w}from"./index.e250aa31.js";const c={oauth_uri:"https://github.com/login/oauth/authorize",redirect_uri:"https://biaochenxuying.cn/login",client_id:"XXXXXXXXX",client_secret:"XXXXXXXXX"};const D=V({name:"RegisterAndLogin",props:{visible:{type:Boolean,default:!1},handleFlag:{type:String,default:!1},isMobile:{type:Boolean,default:!1}},emits:["ok","cancel"],setup(e,a){const F=C(k),l=E({dialogDodel:e.visible,btnLoading:!1,loading:!1,formLabelWidth:e.isMobile?"40px":"60px",params:{email:"",name:"",password:"",phone:"",desc:""}}),h=X(),y=()=>{let t={name:h.name,query:h.query};window.sessionStorage.preventHistory=JSON.stringify(t),window.location.href=`${c.oauth_uri}?client_id=${c.client_id}&redirect_uri=${c.redirect_uri}`},n=async()=>{let t="";l.btnLoading=!0,e.handleFlag==="register"?t=await B.post(_.register,l.params):t=await B.post(_.login,l.params),l.btnLoading=!1;const r={_id:t._id,name:t.name,avatar:t.avatar};F.commit("SAVE_USER",{userInfo:r}),window.sessionStorage.userInfo=JSON.stringify(r),a.emit("ok",!1),m({message:"\u64CD\u4F5C\u6210\u529F",type:"success"})},i=()=>{const t=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");if(l.params.email){if(!t.test(l.params.email)){m({message:"\u8BF7\u8F93\u5165\u683C\u5F0F\u6B63\u786E\u7684\u90AE\u7BB1\uFF01",type:"warning"});return}}else{m({message:"\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"warning"});return}if(e.handleFlag==="register"){if(l.params.password){if(!l.params.name){m({message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"warning"});return}}else{m({message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01",type:"warning"});return}const r=/^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;if(l.params.phone&&!r.test(l.params.phone)){m({message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7!",type:"warning"});return}}n()},b=()=>(a.emit("cancel",!1),!1);return v(e,(t,r)=>{l.dialogDodel=t.visible}),{state:l,handleOAuth:y,handleOk:i,submit:n,cancel:b}}}),$={slot:"footer",class:"dialog-footer"},S=w("github \u6388\u6743\u767B\u5F55"),z=w("\u767B \u5F55"),O=w("\u6CE8 \u518C");function U(e,a,F,l,h,y){const n=f("el-input"),i=f("el-formItem"),b=f("el-form"),t=f("el-button"),r=f("el-dialog");return p(),d(r,{title:"\u767B\u5F55",width:e.isMobile?"90%":"50%",modelValue:e.state.dialogDodel,"onUpdate:modelValue":a[5]||(a[5]=o=>e.state.dialogDodel=o),onClose:e.cancel,"show-close":!0},{default:s(()=>[u(b,null,{default:s(()=>[u(i,{label:"\u90AE\u7BB1","label-width":e.state.formLabelWidth},{default:s(()=>[u(n,{modelValue:e.state.params.email,"onUpdate:modelValue":a[0]||(a[0]=o=>e.state.params.email=o),placeholder:"\u90AE\u7BB1",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),u(i,{label:"\u5BC6\u7801","label-width":e.state.formLabelWidth},{default:s(()=>[u(n,{type:"password",placeholder:"\u5BC6\u7801",modelValue:e.state.params.password,"onUpdate:modelValue":a[1]||(a[1]=o=>e.state.params.password=o),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"]),e.handleFlag==="register"?(p(),d(i,{key:0,label:"\u6635\u79F0","label-width":e.state.formLabelWidth},{default:s(()=>[u(n,{modelValue:e.state.params.name,"onUpdate:modelValue":a[2]||(a[2]=o=>e.state.params.name=o),placeholder:"\u7528\u6237\u540D\u6216\u6635\u79F0",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])):g("",!0),e.handleFlag==="register"?(p(),d(i,{key:1,label:"\u624B\u673A","label-width":e.state.formLabelWidth},{default:s(()=>[u(n,{modelValue:e.state.params.phone,"onUpdate:modelValue":a[3]||(a[3]=o=>e.state.params.phone=o),placeholder:"\u624B\u673A\u53F7",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])):g("",!0),e.handleFlag==="register"?(p(),d(i,{key:2,label:"\u7B80\u4ECB","label-width":e.state.formLabelWidth},{default:s(()=>[u(n,{modelValue:e.state.params.desc,"onUpdate:modelValue":a[4]||(a[4]=o=>e.state.params.desc=o),placeholder:"\u4E2A\u4EBA\u7B80\u4ECB",autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["label-width"])):g("",!0)]),_:1}),L("div",$,[u(t,{type:"success",onClick:e.handleOAuth},{default:s(()=>[S]),_:1},8,["onClick"]),e.handleFlag==="login"?(p(),d(t,{key:0,loading:e.state.btnLoading,type:"primary",onClick:e.handleOk},{default:s(()=>[z]),_:1},8,["loading","onClick"])):g("",!0),e.handleFlag==="register"?(p(),d(t,{key:1,loading:e.state.btnLoading,type:"primary",onClick:e.handleOk},{default:s(()=>[O]),_:1},8,["loading","onClick"])):g("",!0)])]),_:1},8,["width","modelValue","onClose"])}var R=A(D,[["render",U],["__scopeId","data-v-619bf23d"]]);export{R as default};
